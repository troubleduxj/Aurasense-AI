
# Datart 功能借鉴与 AuraSense 系统优化任务清单

## 1. 背景与目标
基于对开源 BI 平台 [Datart](https://github.com/running-elephant/datart) 的深度分析，我们旨在将 AuraSense AI 系统的可视化与交互能力提升至专业 BI 水平。重点增强图表编辑的灵活性、看板的交互性以及数据分析的深度。

## 2. 功能差距分析 (Gap Analysis)

| 功能模块 | Datart 特性 | AuraSense 现状 | 借鉴价值 |
| :--- | :--- | :--- | :--- |
| **图表配置** | 拖拽式字段绑定、精细化样式配置 (颜色/坐标/图例) | 简单的下拉选字段、样式主要靠硬编码 | **高** - 提升作图自由度与美观度，适配不同大屏主题 |
| **看板交互** | 全局控制器 (筛选器)、图表联动 | 静态展示、无全局筛选能力 | **极高** - 这是一个 BI 系统从“看图”转变为“分析数据”的关键 |
| **数据处理** | 计算字段、SQL 自定义视图 | 仅支持原值展示 | **中** - 增强数据表达能力 (如单位换算、状态映射) |
| **钻取联动** | 点击下钻、跳转传参 | 无点击交互 | **中** - 建立宏观到微观的分析路径 |
| **权限控制** | 行级权限 (RLS) | 仅有菜单/页面级权限 | **低** (目前阶段) - 暂不作为核心重点 |

## 3. 优化任务清单与优先级

### 🚨 P0: 核心体验 - 全局筛选控制器 (Dashboard Controllers)
**目标**：让看板“动”起来，支持按时间、设备类型、状态进行全局过滤，模拟 Datart 的 Controller 功能。

*   [ ] **后端/类型定义 (Types)**：
    *   更新 `Dashboard` 类型，增加 `filters` 配置字段（定义看板拥有哪些控制器）。
    *   更新 `RenderChart` 组件接口，接收外部传入的 `filterContext`（过滤上下文）。
*   [ ] **前端 UI - 看板页 (DashboardPage)**：
    *   在 `DashboardPage` 和 `DashboardMonitorPage` 顶部增加“控制器区域 (Controller Bar)”。
    *   实现“时间范围选择器”组件 (Time Picker)。
    *   实现“设备/分类下拉筛选”组件 (Select Filter)。
*   [ ] **数据逻辑 (Data Logic)**：
    *   实现前端数据过滤逻辑：当控制器值改变时，不重新请求 API（Mock 阶段），而是重新计算传递给图表的数据集。

### 🎨 P1: 视觉增强 - 图表样式精细化配置 (Visual Styling)
**目标**：解决图表“千篇一律”的问题，允许用户自定义颜色、坐标轴与图例，参考 Datart 的右侧配置栏。

*   [ ] **类型定义 (Types)**：
    *   扩展 `ChartConfig` 中的 `style` 字段，增加以下属性：
        *   `colors`: string[] (自定义配色方案)
        *   `showGrid`: boolean (显示网格)
        *   `showLegend`: boolean (显示图例)
        *   `legendPosition`: 'top' | 'bottom' (图例位置)
        *   `xAxisLabel`: boolean (显示 X 轴标签)
*   [ ] **前端 UI - 图表实验室 (ChartLabPage)**：
    *   改造 `ChartLabPage`，将编辑区分为“数据配置”与“样式配置”两个 Tab。
    *   开发“样式配置面板”，提供颜色选择器、Switch 开关等控件。
*   [ ] **渲染引擎 (RenderChart)**：
    *   升级 `RenderChart.tsx`，使其渲染逻辑不再依赖硬编码，而是优先读取 `chart.style` 中的配置。

### 🔗 P2: 交互增强 - 图表点击与跳转 (Interactions)
**目标**：打通看板与明细数据的隔阂，实现“发现问题 -> 查看详情”的闭环。

*   [ ] **事件系统**：
    *   为 `RenderChart` 增加 `onClick` 回调。
*   [ ] **跳转逻辑**：
    *   在柱状图/饼图中点击特定扇区（如“Status=Critical”），自动跳转至 `InventoryPage` (设备清单页)。
    *   跳转时自动携带 URL 参数（如 `?status=critical`），并在设备清单页自动应用该筛选条件。

### 🧮 P3: 数据增强 - 计算字段 (Calculated Fields)
**目标**：前端实现简单的数据清洗与转换。

*   [ ] **视图层升级**：
    *   在 `ViewPage` 增加“新建计算字段”功能。
    *   支持简单表达式解析（如 `temperature * 1.8 + 32` 或 `status === 1 ? 'Running' : 'Stop'`）。

## 4. 执行路线图 (Roadmap)
1.  **第一步**：确认此文档无误。
2.  **第二步**：执行 **P0 任务**，改造 `types.ts` 和 `DashboardPage`，引入全局筛选器。
3.  **第三步**：执行 **P1 任务**，改造 `RenderChart` 和 `ChartLabPage`，引入样式配置。
