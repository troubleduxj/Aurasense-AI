# AuraSense AI 系统优化任务清单 V1.0

基于对 Datart (开源 BI) 的深度对比分析，以下是针对 AuraSense AI 当前版本的改进规划。我们的目标是将 AuraSense 从一个“设备监控大屏”升级为具备深度分析能力的“自助式 BI 平台”。

## 1. 核心差距分析 (Gap Analysis)

| 模块 | Datart 特性 | AuraSense 现状 | 优先级 |
| :--- | :--- | :--- | :--- |
| **交互控制** | **全局控制器 (Dashboard Controller)**<br>支持时间、下拉、数值范围等全局筛选。 | **无全局筛选**<br>仅MonitorPage有硬编码筛选，Dashboard仅做展示。 | **P0 (Critical)** |
| **图表引擎** | **ECharts/AntV**<br>高性能，支持缩放、刷选、丰富Tooltip。 | **手写 SVG/React**<br>轻量但扩展难，难以支持复杂交互（如缩放）。 | **P1 (High)** |
| **联动分析** | **跨图表联动 (Cross-Filtering)**<br>点击图表A过滤图表B。 | **仅跳转**<br>点击图表跳转到详情页，缺乏看板内联动。 | **P2 (Medium)** |
| **数据语义** | **复杂计算与SQL视图**<br>支持多表关联(Join)和复杂聚合。 | **单表/宽表模式**<br>主要依赖后端宽表，前端计算能力有限。 | **P3 (Low)** |

---

## 2. 详细任务拆解 (Task Breakdown)

### 🚨 P0: 看板全局控制器 (Dashboard Controllers)
**目标**：实现类似 Datart 的顶部筛选栏，让用户能通过时间、设备类型等维度一次性过滤看板内所有图表。这是 BI 系统最核心的交互功能。

*   **[后端/类型定义]**
    *   [ ] `types.ts`: 更新 `Dashboard` 接口，增加 `controllers` 字段 (定义该看板拥有哪些控制器)。
    *   [ ] `types.ts`: 定义 `ControllerConfig` 类型 (支持 TimeRange, Select, TreeSelect 等类型)。
*   **[前端 UI 开发]**
    *   [ ] `components/ControllerBar.tsx`: 开发看板顶部的通用控制器容器。
    *   [ ] **时间控制器**: 实现 `TimeRangePicker`，支持快捷选时（近1小时、近24小时、近7天）。
    *   [ ] **维度控制器**: 实现 `DynamicSelect`，能从数据源（如设备分类表）动态加载筛选选项。
*   **[数据逻辑注入]**
    *   [ ] `DashboardMonitorPage`: 引入 React Context (`DashboardFilterContext`) 来存储当前的全局筛选状态。
    *   [ ] `RenderChart`: 改造数据处理逻辑，在计算 `metrics` 前，先根据 Context 中的条件过滤 `enrichedDevices` 或原始数据源。

### 🎨 P1: 可视化引擎升级 (Visualization Engine)
**目标**：逐步引入 ECharts 替换现有的手写 SVG `RenderChart`，以大幅提升图表表现力和交互性。

*   **[技术选型]**
    *   [ ] 引入 `echarts` 和 `echarts-for-react` 库。
*   **[组件封装]**
    *   [ ] 创建 `components/charts/BaseEChart.tsx`: 封装通用的 Grid, Tooltip, Axis, Legend 配置。
    *   [ ] 保持与当前 `ChartStyle` (colors, showGrid, legendPosition) 的兼容性。
*   **[图表迁移]**
    *   [ ] **折线/面积图**: 迁移至 ECharts Line，支持数据缩放 (DataZoom) 和多系列堆叠。
    *   [ ] **饼图/环图**: 迁移至 ECharts Pie，支持点击扇区高亮。
    *   [ ] **新图表支持**: 利用 ECharts 能力新增“热力图 (Heatmap)”和“地图 (Geo Map)”，用于展示设备温度分布和地理分布。

### 🔗 P2: 图表联动 (Cross-Filtering)
**目标**：实现“探索式分析”。点击看板中的某个柱状图（例如“故障设备”），其他图表自动过滤只显示故障设备的数据。

*   **[逻辑开发]**
    *   [ ] 建立 Dashboard 级别的事件总线 (Event Bus) 或状态提升。
    *   [ ] `RenderChart` 点击事件 (`onInteract`) 不再只是跳转，而是触发 `setGlobalFilter({ [dimension]: value })`。
*   **[UI 反馈]**
    *   [ ] 在被筛选的图表上显示“过滤漏斗”图标，允许用户清除联动条件。
    *   [ ] 视觉上高亮被选中的数据项。

### 🧮 P3: 高级数据视图 (Advanced Data View)
**目标**：增强数据预处理能力，减少对后端 API 的依赖。

*   **[功能开发]**
    *   [ ] **SQL 视图模式**: 在 `ViewPage` 增加“SQL Mode”，允许高级用户直接编写 SQL (针对 TDengine/PostgreSQL) 来定义数据集。
    *   [ ] **聚合方式配置**: 在 `ChartLabPage` 允许用户选择聚合函数 (SUM, AVG, MAX, MIN)，而不仅仅是默认的 AVG。

---

## 3. 执行路线图 (Roadmap)

1.  **Phase 1 (本周)**: 
    *   完成 **P0 (全局控制器)** 的开发。这将立竿见影地提升看板的实用性。
    *   在 `types.ts` 中定义 Controller 结构。
2.  **Phase 2 (下周)**:
    *   引入 ECharts 库，创建一个新的 `RenderEChart` 组件进行灰度测试 (P1)。
3.  **Phase 3 (下下周)**:
    *   基于新的 ECharts 组件实现图表联动 (P2)。

## 4. 验收标准
*   用户可以在看板顶部选择“过去 24 小时”，所有图表（折线图、KPI 卡片）的数据范围自动同步更新。
*   用户可以在看板顶部选择“设备类型=传感器”，所有图表仅展示传感器相关数据。
